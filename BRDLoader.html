<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<title>Level</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="CCLogo.png">
<style>
:root{
    --bg-dark:#050505;
    --accent-red:#ff1f1f;
    --accent-blue:#0077ff;
    --glow-red:rgba(255,31,31,0.4);
    --glow-blue:rgba(0,119,255,0.4);
}
/* Keep all other styles exactly as your existing loader */
*{box-sizing:border-box;}
body{margin:0;min-height:100vh;background:var(--bg-dark);background-image:radial-gradient(circle at 0% 0%, var(--glow-red) 0%, transparent 40%),radial-gradient(circle at 100% 100%, var(--glow-blue) 0%, transparent 40%);color:white;font-family:'Segoe UI',system-ui,sans-serif;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.level-panel{width:420px;max-width:90%;padding:30px;background:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.1);border-radius:14px;text-align:center;box-shadow:0 0 40px rgba(0,0,0,0.6);animation:panelIn 0.6s ease-out;}
h1{margin:0;font-size:3rem;letter-spacing:6px;text-transform:uppercase;}
.subtitle{opacity:0.7;margin:10px 0 25px;}
.question-tile{margin-bottom:25px;padding:20px;border-radius:12px;background:rgba(255,255,255,0.05);border:1px dashed rgba(255,255,255,0.2);text-align:left;}
.question-tile p{margin:0 0 10px;font-weight:bold;font-size:1.2rem;}
.question-tile input{width:100%;padding:10px;font-size:1rem;border-radius:6px;border:1px solid rgba(255,255,255,0.3);background:transparent;color:white;}
.feedback{margin-top:8px;color:var(--accent-red);font-weight:bold;min-height:1.2em;}
.buttons{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
button{padding:12px;font-size:1rem;border-radius:8px;border:none;cursor:pointer;text-transform:uppercase;letter-spacing:2px;transition:transform 0.15s ease,box-shadow 0.15s ease;}
button:hover{transform:scale(1.06);}
button:active{transform:scale(0.94);}
.btn-menu{background:transparent;border:2px solid var(--accent-red);color:var(--accent-red);}
.btn-action{background:var(--accent-blue);color:white;}
.complete-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.4s ease;}
.complete-overlay.active{opacity:1;pointer-events:all;}
.complete-box{width:520px;max-width:92%;min-height:260px;background:#000;padding:50px 40px;border-radius:18px;text-align:center;box-shadow:0 0 60px rgba(0,119,255,0.45),0 0 120px rgba(255,31,31,0.25);animation:panelIn 0.45s ease-out;}
.complete-box h2{font-size:3rem;margin:0 0 25px;letter-spacing:4px;}
.btn-next{font-size:1.3rem;padding:14px 36px;border-radius:8px;background:var(--accent-red);color:white;cursor:pointer;}
@keyframes panelIn{from{opacity:0;transform:scale(0.94) translateY(10px);}to{opacity:1;transform:scale(1) translateY(0);}}
</style>
</head>

<body>
<div class="level-panel">
<h1 id="levelHeading">LEVEL</h1>
<div class="subtitle">Complete the task</div>
<div class="question-tile">
<p id="questionText"></p>
<input id="answerInput" type="text" placeholder="Type your answer">
<div class="feedback" id="feedback"></div>
</div>
<div class="buttons">
<button class="btn-action" id="retryBtn">Retry</button>
<button class="btn-action" id="submitBtn">Submit</button>
<button class="btn-menu" onclick="goToLevelSelect()">Level Select</button>
<button class="btn-menu" onclick="goToMenu()">Main Menu</button>
</div>
</div>

<div class="complete-overlay" id="completeOverlay">
<div class="complete-box">
<h2 id="completeHeading"></h2>
<button class="btn-next" id="nextBtn">Next</button>
</div>
</div>

<script>
const params = new URLSearchParams(location.search);
let presetFile = params.get("preset") || "Classic.json"; // default
let currentLevel = parseInt(params.get("l")) || 1;

let preset = null;
let TOTAL_LEVELS = 0;

// DOM references
const levelHeading = document.getElementById("levelHeading");
const questionText = document.getElementById("questionText");
const answerInput = document.getElementById("answerInput");
const feedback = document.getElementById("feedback");
const submitBtn = document.getElementById("submitBtn");
const retryBtn = document.getElementById("retryBtn");
const nextBtn = document.getElementById("nextBtn");
const completeOverlay = document.getElementById("completeOverlay");

// Load preset JSON
fetch(`presets/${presetFile}`)
  .then(res => res.json())
  .then(data => {
      preset = data;
      TOTAL_LEVELS = preset.levels.length;

      // Apply corner colors
      document.body.style.backgroundImage = `
          radial-gradient(circle at 0% 0%, ${preset.color1} 0%, transparent 40%),
          radial-gradient(circle at 100% 100%, ${preset.color2} 0%, transparent 40%)
      `;

      setupLevel(currentLevel);
  })
  .catch(err => {
      console.error("Failed to load preset:", err);
      levelHeading.textContent = "Error loading preset";
  });

// Setup a level
function setupLevel(level) {
    if (!preset || !preset.levels[level - 1]) {
        // Level does not exist → send back to menu
        location.href = "CCMenu1.html";
        return;
    }

    const q = preset.levels[level - 1];
    levelHeading.textContent = `LEVEL ${level}`;
    document.title = `Level ${level} - ${preset.title}`;
    questionText.textContent = q.q;
    answerInput.value = "";
    feedback.textContent = "";
    submitBtn.disabled = false;
    completeOverlay.classList.remove("active");
}

// Jump to another level
function jumpTo(level) {
    if (level < 1) return;
    if (level > TOTAL_LEVELS) {
        // Last level → go to credits
        location.href = "BRDCred+Specials.html";
        return;
    }
    // Reload loader with new level and same preset
    location.href = `BRDLoader.html?preset=${presetFile}&l=${level}`;
}

// Button events
submitBtn.onclick = () => {
    const userAnswer = answerInput.value.trim();
    const correctAnswer = preset.levels[currentLevel - 1].a;

    if (handleDevCommands(userAnswer)) return;

    if (userAnswer === correctAnswer) {
        completeOverlay.classList.add("active");
    } else {
        feedback.textContent = "Wrong answer. Hit Retry.";
        submitBtn.disabled = true;
    }
};

retryBtn.onclick = () => {
    answerInput.value = "";
    feedback.textContent = "";
    submitBtn.disabled = false;
};

nextBtn.onclick = () => {
    jumpTo(currentLevel + 1);
};

function goToMenu() {
    location.href = "CCMenu1.html";
}

function goToLevelSelect() {
    location.href = `CCMenu1.html#level-select`;
}

// Optional: Dev commands
function handleDevCommands(input) {
    const v = input.trim().toUpperCase();

    if (v === "BRDNEXT") {
        completeOverlay.classList.add("active");
        return true;
    }

    if (v === "BRDPREV") {
        jumpTo(currentLevel - 1);
        return true;
    }

    if (v.startsWith("BRDSKIP")) {
        const t = parseInt(v.replace("BRDSKIP", ""));
        if (!isNaN(t)) jumpTo(t);
        return true;
    }

    if (v === "BRDBUILD") {
        location.href = "BRDBuilder.html";
        return true;
    }

    return false;
}
</script>

</body>
</html>
